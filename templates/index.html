<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Monthly Arrival Predictions</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  {% include 'navbar.html' %}

  <div class="content">
  <h1>Predict Arrivals</h1>
  <label for="monthSelect" style="font-size: 16px;">Select a month to predict:</label>
  <select id="monthSelect"></select>

  <br>
  <button onclick="getPrediction()" style="display: block; margin-top: 20px;">Get Prediction</button>

  <div id="result" style="margin-top:20px;"></div>
  <canvas id="countryChart" width="400" height="300" style="margin-top: 30px;"></canvas>

  <script>
    const monthSelect = document.getElementById('monthSelect');
    const resultDiv = document.getElementById('result');
    const ctx = document.getElementById('countryChart').getContext('2d');
    let countryChart = null;

    // Get list of months from backend
    fetch('/months')
      .then(response => response.json())
      .then(dates => {
        dates.forEach(month => {
          const option = document.createElement('option');
          option.value = month;
          option.textContent = month;
          monthSelect.appendChild(option);
        });
      });

    function getPrediction() {
      const selectedMonth = monthSelect.value;
      fetch('/predict', {
        method: 'POST',
        headers: {'Content-Type': 'application/json'},
        body: JSON.stringify({ selected_month: selectedMonth })
      })
      .then(res => res.json())
      .then(data => {
        if (data.error) {
          resultDiv.innerHTML = `<p style="color:red;">${data.error}</p>`;
          if (countryChart) {
          countryChart.destroy();
        }
        } else {
          resultDiv.innerHTML = `<h2>${data.month}</h2><p>Predicted Arrivals: <strong>${data.prediction}</strong></p>`;

          const labels = data.top_countries.map(item => item[0]);
        const counts = data.top_countries.map(item => item[1]);

        if (countryChart) {
          countryChart.destroy(); // Remove previous chart
        }

         countryChart = new Chart(ctx, {
          type: 'bar',
          data: {
            labels: labels,
            datasets: [{
              label: 'Predicted Arrivals',
              data: counts,
              backgroundColor: 'rgba(54, 162, 235, 0.7)',
              borderColor: 'rgba(54, 162, 235, 1)',
              borderWidth: 1
            }]
          },
          options: {
            scales: {
              y: {
                beginAtZero: true
              }
            }
          }
        });
        
        }
      });
    }
  </script>
  </div>
</body>
</html>
